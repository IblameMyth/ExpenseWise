<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Test - User Data Isolation & Remember Me</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        .test-button {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
        }
        .test-button:hover {
            transform: translateY(-2px);
        }
        .result {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üß™ ExpenseWise Feature Test</h1>
    
    <div class="test-section">
        <h2>1. Account-Specific Data Isolation Test</h2>
        <p>This test verifies that different user accounts have separate expense data.</p>
        <button class="test-button" onclick="testDataIsolation()">Test Data Isolation</button>
        <div id="isolation-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. Remember Me Functionality Test</h2>
        <p>This test verifies that remember me saves and restores username and password.</p>
        <button class="test-button" onclick="testRememberMe()">Test Remember Me</button>
        <div id="remember-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. User-Specific Storage Keys Test</h2>
        <p>Shows how storage keys are organized for different users.</p>
        <button class="test-button" onclick="testStorageKeys()">Show Storage Organization</button>
        <div id="storage-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>4. Clean Up Test Data</h2>
        <button class="test-button" onclick="cleanupTestData()">Clean Up Test Data</button>
        <div id="cleanup-result" class="result"></div>
    </div>

    <script>
        // Simulate the auth system functions for testing
        function getCurrentUser() {
            const session = localStorage.getItem('expenseWiseSession');
            return session ? JSON.parse(session) : null;
        }

        function getUserExpenseKey(date, username) {
            return `expense_${username}_${date}`;
        }

        function testDataIsolation() {
            const result = document.getElementById('isolation-result');
            let output = "Testing Account-Specific Data Isolation...\n\n";

            // Create test data for different users
            const testUsers = [
                { username: 'alice', data: { food: 500, travel: 200, misc: 100, total: 800 } },
                { username: 'bob', data: { food: 300, travel: 400, misc: 200, total: 900 } },
                { username: 'charlie', data: { food: 600, travel: 100, misc: 50, total: 750 } }
            ];

            const testDate = '2025-11-13';

            // Store test data for each user
            testUsers.forEach(user => {
                const key = getUserExpenseKey(testDate, user.username);
                const expenseData = {
                    date: testDate,
                    food: user.data.food,
                    travel: user.data.travel,
                    misc: user.data.misc,
                    total: user.data.total
                };
                localStorage.setItem(key, JSON.stringify(expenseData));
                output += `‚úÖ Stored data for ${user.username}: ‚Çπ${user.data.total}\n`;
            });

            output += "\nVerifying data isolation:\n";

            // Verify each user can only see their own data
            testUsers.forEach(user => {
                const key = getUserExpenseKey(testDate, user.username);
                const storedData = localStorage.getItem(key);
                
                if (storedData) {
                    const data = JSON.parse(storedData);
                    output += `‚úÖ ${user.username} sees only their data: ‚Çπ${data.total}\n`;
                } else {
                    output += `‚ùå Failed to retrieve data for ${user.username}\n`;
                }
            });

            // Show that users don't see each other's data
            output += "\nCross-user access test:\n";
            const aliceKey = getUserExpenseKey(testDate, 'alice');
            const bobKey = getUserExpenseKey(testDate, 'bob');
            
            output += `Alice's key: ${aliceKey}\n`;
            output += `Bob's key: ${bobKey}\n`;
            output += `Keys are different: ${aliceKey !== bobKey ? '‚úÖ PASS' : '‚ùå FAIL'}\n`;

            result.textContent = output;
        }

        function testRememberMe() {
            const result = document.getElementById('remember-result');
            let output = "Testing Remember Me Functionality...\n\n";

            // Test saving credentials
            const testUsername = 'testuser123';
            const testPassword = 'mypassword456';

            // Simulate remember me saving
            localStorage.setItem('rememberedUser', JSON.stringify({
                username: testUsername,
                savedAt: new Date().toISOString()
            }));

            localStorage.setItem(`savedCredentials_${testUsername}`, JSON.stringify({
                password: testPassword,
                savedAt: new Date().toISOString()
            }));

            output += `‚úÖ Saved credentials for: ${testUsername}\n`;

            // Test retrieval
            const rememberedUser = localStorage.getItem('rememberedUser');
            if (rememberedUser) {
                const userInfo = JSON.parse(rememberedUser);
                output += `‚úÖ Retrieved remembered username: ${userInfo.username}\n`;

                const savedCreds = localStorage.getItem(`savedCredentials_${userInfo.username}`);
                if (savedCreds) {
                    const creds = JSON.parse(savedCreds);
                    output += `‚úÖ Retrieved saved password: ${'*'.repeat(creds.password.length)}\n`;
                    output += `‚úÖ Password matches: ${creds.password === testPassword ? 'YES' : 'NO'}\n`;
                } else {
                    output += `‚ùå Could not retrieve saved password\n`;
                }
            } else {
                output += `‚ùå Could not retrieve remembered user\n`;
            }

            // Test account switching with credentials
            output += "\nAccount switching with saved credentials:\n";
            const users = ['user1', 'user2', 'user3'];
            
            users.forEach(user => {
                localStorage.setItem(`savedCredentials_${user}`, JSON.stringify({
                    password: `password_${user}`,
                    savedAt: new Date().toISOString()
                }));
                output += `‚úÖ Saved credentials for ${user}\n`;
            });

            output += "\nRetrieving different user credentials:\n";
            users.forEach(user => {
                const creds = localStorage.getItem(`savedCredentials_${user}`);
                if (creds) {
                    const data = JSON.parse(creds);
                    output += `‚úÖ ${user}: ${'*'.repeat(data.password.length)}\n`;
                }
            });

            result.textContent = output;
        }

        function testStorageKeys() {
            const result = document.getElementById('storage-result');
            let output = "Current localStorage Organization:\n\n";

            const categories = {
                'User Accounts': [],
                'Sessions': [],
                'Remember Me': [],
                'User Data': [],
                'Other': []
            };

            // Categorize all localStorage keys
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                
                if (key.startsWith('expenseWiseUsers')) {
                    categories['User Accounts'].push(key);
                } else if (key.startsWith('expenseWiseSession')) {
                    categories['Sessions'].push(key);
                } else if (key.startsWith('rememberedUser') || key.startsWith('savedCredentials_')) {
                    categories['Remember Me'].push(key);
                } else if (key.includes('expense_') || key.includes('Expenses_')) {
                    categories['User Data'].push(key);
                } else {
                    categories['Other'].push(key);
                }
            }

            // Display categorized keys
            Object.entries(categories).forEach(([category, keys]) => {
                output += `üìÅ ${category} (${keys.length}):\n`;
                if (keys.length === 0) {
                    output += "   (empty)\n";
                } else {
                    keys.forEach(key => {
                        const value = localStorage.getItem(key);
                        const size = value ? value.length : 0;
                        output += `   ${key} (${size} chars)\n`;
                    });
                }
                output += "\n";
            });

            result.textContent = output;
        }

        function cleanupTestData() {
            const result = document.getElementById('cleanup-result');
            let output = "Cleaning up test data...\n\n";

            let deletedCount = 0;
            const keysToDelete = [];

            // Find test keys
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && (
                    key.includes('testuser123') ||
                    key.includes('alice') ||
                    key.includes('bob') ||
                    key.includes('charlie') ||
                    key.includes('user1') ||
                    key.includes('user2') ||
                    key.includes('user3')
                )) {
                    keysToDelete.push(key);
                }
            }

            // Delete test keys
            keysToDelete.forEach(key => {
                localStorage.removeItem(key);
                deletedCount++;
                output += `üóëÔ∏è Removed: ${key}\n`;
            });

            output += `\n‚úÖ Cleaned up ${deletedCount} test entries.\n`;
            result.textContent = output;
        }
    </script>
</body>
</html>