<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Expense</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root{
            --bg:#f8fafc;
            --card:rgba(255, 255, 255, 0.9);
            --muted:#6b7280;
            --text:#0f172a;
            --primary:#2563eb;
            --accent:#0ea5a4;
            --radius:12px;
            --shadow:0 8px 26px rgba(15,23,42,0.06);
            --container:1100px;
            --bg-img:url('https://images.unsplash.com/photo-1542223616-1e7b2d2b02d9?auto=format&fit=crop&w=1500&q=80');
            --glass-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            --glass-border: 1px solid rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        *{box-sizing:border-box}html,body{height:100%}
        body{margin:0;padding:28px;font-family:Inter,'Segoe UI',Roboto;background-image:linear-gradient(rgba(255,255,255,0.86),rgba(255,255,255,0.86)),var(--bg-img);background-size:cover;background-position:center;color:var(--text)}
        main{
            max-width:var(--container);
            margin:0 auto;
            min-height:68vh;
            padding:28px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: var(--glass-border);
            border-radius: var(--radius);
            box-shadow: var(--glass-shadow);
        }
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
        header{display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#ffffff,#f8fafc);color:#0f172a;padding:16px 20px;border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:18px;border:1px solid rgba(2,6,23,0.08)}
        header h1{margin:0;font-size:1.6rem;font-family:'Poppins',sans-serif;font-weight:600;letter-spacing:0.5px;background:linear-gradient(90deg,var(--accent),var(--primary));-webkit-background-clip:text;background-clip:text;color:transparent}
        
        .expense-form {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            box-shadow: var(--glass-shadow);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text);
        }
        
        input {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #e6eef8;
            background: #fff;
            margin-bottom: 10px;
        }
        
        select {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #e6eef8;
            background: #fff;
            margin-bottom: 10px;
        }
        
        button {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(90deg,var(--primary),var(--accent));
            color: #fff;
            cursor: pointer;
            font-weight: 500;
            margin: 5px;
        }
        
        button.danger {
            background: linear-gradient(90deg, #dc2626, #ef4444);
        }
        
        .summary-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.8));
            padding: 20px;
            border-radius: var(--radius);
            margin-top: 20px;
            box-shadow: var(--glass-shadow);
        }
        
        footer{margin-top:36px;text-align:center;color:var(--muted)}
    </style>
</head>
<body>
    <header>
        <img src="images/logo.png" alt="ExpenseWise Logo" class="site-logo">
        <h1>ExpenseWise</h1>
    </header>
    
    <main>
        <div class="expense-form">
            <h2>Add New Expense</h2>
            <div class="form-group">
                <label for="expenseCategory">Category:</label>
                <select id="expenseCategory" onchange="updateFields()">
                    <option value="">Select Category</option>
                    <option value="food">Food</option>
                    <option value="travel">Travel</option>
                    <option value="entertainment">Entertainment</option>
                    <option value="emi">EMI</option>
                    <option value="vacation">Vacation</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="expenseDate">Date:</label>
                <input type="date" id="expenseDate" required>
            </div>
            
            <div id="dynamicFields"></div>
            
            <button onclick="saveExpense()">Save Expense</button>
            <button onclick="clearForm()" class="danger">Clear Form</button>
        </div>
        
        <div class="summary-card" id="summary"></div>
    </main>
    
    <footer>
        Track your expenses wisely to secure your future.
    </footer>
    
    <script>
        // Category field configurations
        const categoryFields = {
            food: [
                { id: 'groceries', label: 'Groceries (₹)' },
                { id: 'drinks', label: 'Drinks (₹)' },
                { id: 'dining', label: 'Dining Out (₹)' }
            ],
            travel: [
                { id: 'auto', label: 'Auto (₹)' },
                { id: 'bus', label: 'Bus (₹)' },
                { id: 'metro', label: 'Metro (₹)' },
                { id: 'petrol', label: 'Petrol (₹)' }
            ],
            entertainment: [
                { id: 'movies', label: 'Movies (₹)' },
                { id: 'parties', label: 'Parties (₹)' },
                { id: 'gatherings', label: 'Family Gatherings (₹)' }
            ],
            emi: [
                { id: 'homeLoan', label: 'Home Loan EMI (₹)' },
                { id: 'carLoan', label: 'Car Loan EMI (₹)' },
                { id: 'educationLoan', label: 'Education Loan EMI (₹)' },
                { id: 'personalLoan', label: 'Personal Loan EMI (₹)' }
            ],
            vacation: [
                { id: 'tickets', label: 'Tickets (₹)' },
                { id: 'hostel', label: 'Hostel (₹)' },
                { id: 'food', label: 'Food (₹)' },
                { id: 'traveling', label: 'Traveling (₹)' }
            ]
        };

        // Initialize with today's date
        window.addEventListener('load', function() {
            const today = new Date();
            document.getElementById('expenseDate').value = today.toISOString().split('T')[0];
        });

        function updateFields() {
            const category = document.getElementById('expenseCategory').value;
            const fieldsContainer = document.getElementById('dynamicFields');
            fieldsContainer.innerHTML = '';

            if (!category) return;

            categoryFields[category].forEach(field => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <label for="${field.id}">${field.label}</label>
                    <input type="number" id="${field.id}" placeholder="0">
                `;
                fieldsContainer.appendChild(div);
            });
        }

        function saveExpense() {
            const category = document.getElementById('expenseCategory').value;
            const date = document.getElementById('expenseDate').value;
            
            if (!category || !date) {
                alert('Please select both category and date');
                return;
            }

            const expenseData = {
                category,
                date,
                amounts: {}
            };

            let total = 0;
            categoryFields[category].forEach(field => {
                const amount = parseFloat(document.getElementById(field.id).value) || 0;
                expenseData.amounts[field.id] = amount;
                total += amount;
            });

            // Save to localStorage
            const storageKey = `expense_${category}_${date}`;
            localStorage.setItem(storageKey, JSON.stringify(expenseData));

            // Also save to monthly tracking
            const month = date.substring(0, 7); // YYYY-MM
            const monthlyKey = `${category}Expenses_${month}`;
            localStorage.setItem(monthlyKey, JSON.stringify(expenseData));

            // Update summary
            document.getElementById('summary').innerHTML = `
                <h3>Expense Saved Successfully</h3>
                <p>Category: ${category.charAt(0).toUpperCase() + category.slice(1)}</p>
                <p>Date: ${date}</p>
                <p>Total Amount: ₹${total}</p>
            `;

            // Attempt to save to XML via PHP
            fetch('save_expense.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    type: 'daily',
                    category: category,
                    date: date,
                    amounts: expenseData.amounts,
                    total: total
                })
            })
            .then(response => response.json())
            .then(data => console.log('Saved to XML:', data))
            .catch(error => console.error('Error saving to XML:', error));
        }

        function clearForm() {
            document.getElementById('expenseCategory').value = '';
            document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('dynamicFields').innerHTML = '';
            document.getElementById('summary').innerHTML = '';
        }
    </script>
</body>
</html>